<!DOCTYPE html>
<html>
    <head>
		<meta name="viewport" content="width=device-width">
        <title>Trojka software: Nieuwjaar</title>
        <style type="text/css">
            body{font-family: arial; background: #FFFFFF}
			.calcTextSizeContainer {
				overflow-x: scroll;
				white-space: nowrap;
				font-size: 3em;
			}
			.calcTextSizeSpan {
				display: inline-block;
				white-space: nowrap;
			}
        </style>
		<script type="text/javascript" src="script/raphael.min.js" /></script>
		<script type="text/javascript" src="script/jquery-3.1.1.min.js" /></script>
    </head>
    <body id="theBody">
		<div >

		</div>
		<div id="textCalculatorContainer" class="calcTextSizeContainer">
			<span id="textCalculator" class="calcTextSizeSpan"></span>
		</div>
		
        <div id="canvas"></div>

	<!--Script at the bottom of the page-->
    <script>
	
		var bodyMargin = parseFloat( $("#theBody").css('margin'));
		var longestTekstOnThisPage = "Nog 99 dagen 99:99:99";
		var longestTextWidth = $("#textCalculator").html(longestTekstOnThisPage).width();
		var documentWidth = $(document).width() - 2 * bodyMargin;
		var fontHeight = parseFloat($("#textCalculator").css('font-size'));
		$("#textCalculatorContainer").remove();

		if (documentWidth < longestTextWidth) {
			var horizontalScale = documentWidth / longestTextWidth;
			fontHeight = fontHeight * horizontalScale;
		}

		var textHeight = fontHeight + "px";


		var pathStyle = {
			"opacity":0
		}

		var now = new Date();
		//var newYear = new Date(2016, 11, 17, 21, 47, 45);
		//var newYear = new Date(2017, 0, 1, 0, 0, 0);
		var newYear = new Date(now.getTime() + 1000 * 15);

		function pad2(num) {
			var s = "0" + num;
			return s.substr(s.length - 2);
		}

		var strokeWidth = 35;

		function trojkaLogo(canvas, x, y, size) {
			canvas.setStart();

			var scale = size / (2 * 339.68405);

			var trojkaOuterCircle = canvas.ellipse(371.07144, 512.4693, 339.68405, 339.68405).attr({ fill: "none", "stroke": "#000000", "stroke-width": scale * strokeWidth, "stroke-linecap": "round", "stroke-linejoin": "round" });
			trojkaOuterCircle.id = 'trojkaOuterCircle';
			var face1 = "m 231.07143,292.71932 -120,240 120,0 0,200.00002 80,0";
			var face2 = "m 391.07143,292.71932 -120,240 120,0 0,200.00002 80,-40";
			var face3 = "m 551.07143,292.71932 -120,240 120,0 0,200.00002 80,-80";
			var trojkaLogoPart1 = canvas.path(face1).attr({ fill: "none", "stroke": "#000000", "stroke-width": scale * strokeWidth, "stroke-linecap": "round", "stroke-linejoin": "round" });
			trojkaLogoPart1.id = 'trojkaLogoPart1';
			var trojkaLogoPart2 = canvas.path(face2).attr({ fill: "none", "stroke": "#000000", "stroke-width": scale * strokeWidth, "stroke-linecap": "round", "stroke-linejoin": "round" });
			trojkaLogoPart2.id = 'trojkaLogoPart2';
			var trojkaLogoPart3 = canvas.path(face3).attr({ fill: "none", "stroke": "#000000", "stroke-width": scale * strokeWidth, "stroke-linecap": "round", "stroke-linejoin": "round" });
			trojkaLogoPart3.id = 'trojkaLogoPart3';
			var trojkaLogoPart4 = canvas.circle(273.57144, 375.21933, strokeWidth / 2).attr({ fill: "#000000", "stroke": "#000000", "stroke-width": 1 });
			trojkaLogoPart4.id = 'trojkaLogoPart4';
			var trojkaLogoPart5 = canvas.circle(433.07144, 375.71933, strokeWidth / 2).attr({ fill: "#000000", "stroke": "#000000", "stroke-width": 1 });
			trojkaLogoPart5.id = 'trojkaLogoPart5';
			var trojkaLogoPart6 = canvas.circle(593.07141, 375.71933, strokeWidth / 2).attr({ fill: "#000000", "stroke": "#000000", "stroke-width": 1 });
			trojkaLogoPart6.id = 'trojkaLogoPart6';

			var completeSet = canvas.setFinish();
			var tX = -371.07144;
			var tY = -512.4693;
			completeSet.transform("S" + scale + "," + scale + ",371.07,512.47T" + (tX + x) + "," + (tY + y));//.transform("");
		}

		function prettyTimespan(start, end) {
			var diff = end.getTime() - start.getTime();
			var days = Math.floor(diff / (1000 * 60 * 60 * 24));
			diff -= days * (1000 * 60 * 60 * 24);
			var hours = Math.floor(diff / (1000 * 60 * 60));
			diff -= hours * (1000 * 60 * 60);
			var mins = Math.floor(diff / (1000 * 60));
			diff -= mins * (1000 * 60);
			var seconds = Math.floor(diff / (1000));
			diff -= seconds * (1000);

			var timeMessage = "";
			if (days > 0)
				timeMessage = "Over " + days + ((days > 1) ? " dagen" : " dag");
			else {
				var hoursMessage = "";
				if (hours > 0)
					timeMessage = "Over " + hours + ((hours > 1) ? " uren" : " uur");
				else {
					var minutesMessage = "";
					if (mins > 0)
						timeMessage = "Over " + mins + ((mins > 1) ? " minuten" : " minuut");
					else {
					var secondsMessage = "";
					if (seconds > 0)
						timeMessage = "Nog " + seconds + " seconden";
					}
				}
			}

			return timeMessage;
		}

		function prettyFullTimespan(start, end) {
			var diff = end.getTime() - start.getTime();
			if (diff < 0) {
				return "De tijd is verstreken";
			}

			var days = Math.floor(diff / (1000 * 60 * 60 * 24));
			diff -= days * (1000 * 60 * 60 * 24);
			var hours = Math.floor(diff / (1000 * 60 * 60));
			diff -= hours * (1000 * 60 * 60);
			var mins = Math.floor(diff / (1000 * 60));
			diff -= mins * (1000 * 60);
			var seconds = Math.floor(diff / (1000));
			diff -= seconds * (1000);

			var timeMessage = "";
			var dayMessage = "";
			if (days > 0)
				dayMessage = days + ((days > 1) ? " dagen" : " dag");
			var hoursMessage = "";
			if (hours > 0)
				hoursMessage = (days > 0 ? " " : "") + pad2(hours) + ":";
			var minutesMessage = "";
			var secondsMessage = "";
			if (days == 0 && hours == 0 && mins == 0)  {
				secondsMessage = seconds + " seconden";
			}
			else {
				minutesMessage = pad2(mins) + ":";
				secondsMessage = pad2(seconds);
			}

			return "Nog " + dayMessage + hoursMessage + minutesMessage + secondsMessage;
		}

		var prettyMessage = prettyTimespan(now, newYear);



        var paper = Raphael("canvas", '100%', 500);  
        var offsetWidth = $("#canvas").width();
        var textPositionY = 50;
        var textPadding = 5;
        var verticalSpacing = parseFloat(textHeight);
        var conversationMargin = 10;
		
        var conversationStep = 0;
        var t11 = paper.text(conversationMargin, textPositionY + (conversationStep * verticalSpacing), "Wat gebeurt er?").attr({ "font-size": textHeight, "font-family": "Arial, Helvetica, sans-serif", "text-anchor": "start" }).attr({ fill: '#FFFFFF' }); conversationStep++;
        var t21 = paper.text(offsetWidth - conversationMargin, textPositionY + (conversationStep * verticalSpacing), "Vuurwerk").attr({ "font-size": textHeight, "font-family": "Arial, Helvetica, sans-serif", "text-anchor": "end" }).attr({ fill: '#FFFFFF' }); conversationStep++;
        var t12 = paper.text(conversationMargin, textPositionY + (conversationStep * verticalSpacing), "Wanneer?").attr({ "font-size": textHeight, "font-family": "Arial, Helvetica, sans-serif", "text-anchor": "start" }).attr({ fill: '#FFFFFF' }); conversationStep++;
        var t22 = paper.text(offsetWidth - conversationMargin, textPositionY + (conversationStep * verticalSpacing), prettyMessage).attr({ "font-size": textHeight, "font-family": "Arial, Helvetica, sans-serif", "text-anchor": "end" }).attr({ fill: '#FFFFFF' }); conversationStep++;

        var followUpLine1 = "Nog zo lang?";
        var followUpLine2 = "Yep, kom dan 's terug.";
        var followUpLine3 = "Doe ik";
        var mintuesXAlternative = 5 * 60 * 1000;
        if (mintuesXAlternative > (newYear.getTime() - now.getTime())) {
        	followUpLine1 = "Spannend";
        	followUpLine2 = "Best blijven kijken";
        	followUpLine3 = "Doe ik";
        }

        var t13 = paper.text(conversationMargin, textPositionY + (conversationStep * verticalSpacing), followUpLine1).attr({ "font-size": textHeight, "font-family": "Arial, Helvetica, sans-serif", "text-anchor": "start" }).attr({ fill: '#FFFFFF' }); conversationStep++;
        var t24 = paper.text(offsetWidth - conversationMargin, textPositionY + (conversationStep * verticalSpacing), followUpLine2).attr({ "font-size": textHeight, "font-family": "Arial, Helvetica, sans-serif", "text-anchor": "end" }).attr({ fill: '#FFFFFF' }); conversationStep++;
        var t14 = paper.text(conversationMargin, textPositionY + (conversationStep * verticalSpacing), followUpLine3).attr({ "font-size": textHeight, "font-family": "Arial, Helvetica, sans-serif", "text-anchor": "start" }).attr({ fill: '#FFFFFF' }); conversationStep++;

        var fadeDuration = 1; //700;
        var fixDuration = 1; //1500;
        var pauseDuration = 1; //200;
		var cycleDuration = 2 * fadeDuration + fixDuration + pauseDuration;
		
		var fadeOutAnimation = Raphael.animation({
			"fill" : "#FFFFFF",
		}, fadeDuration);
	
		var fadeInOutAnimation = Raphael.animation({
			"fill" : "#000000",
		}, fadeDuration, function () {
			this.animate(fadeOutAnimation.delay(fixDuration));
		});

		var timerId;
		var fadeOutAndStartCountDownAnimation = Raphael.animation({
			"fill": "#FFFFFF",
		}, fadeDuration, function () {
			timerId = window.setInterval(timeFunction, 1000);
		});

		var verticalOffset = 170;
		var logoMargin = 30;
		var logoSize = verticalOffset - 2 * logoMargin;

		var secondsCountDown = 6;

		var timeFunction = function () {
			var fullPrettyMessage = prettyFullTimespan(new Date(), newYear);

			var prettyTimeElem = paper.getById('timeText');
			if (prettyTimeElem == undefined) {
				trojkaLogo(paper, offsetWidth / 2, verticalOffset / 2, logoSize);
				prettyTimeElem = paper.text(offsetWidth / 2, verticalOffset, "").attr({ id: 'timeText' }).attr({ "font-size": textHeight, "font-family": "Arial, Helvetica, sans-serif", "text-anchor": "middle" }).attr({ fill: '#000000' });
				prettyTimeElem.id = 'timeText';
			}
			prettyTimeElem.attr({ text: fullPrettyMessage });

			if (secondsCountDown * 1000 > (newYear.getTime() - new Date().getTime())) {
				window.clearInterval(timerId);
				prettyTimeElem.animate({ fill: "#FFFFFF" }, 200);
				paper.getById('trojkaLogoPart1').animate({ stroke: "#FFFFFF" }, 200, function () { paper.getById('trojkaLogoPart1').remove() });
				paper.getById('trojkaLogoPart2').animate({ stroke: "#FFFFFF" }, 200, function () { paper.getById('trojkaLogoPart2').remove() });
				paper.getById('trojkaLogoPart3').animate({ stroke: "#FFFFFF" }, 200, function () { paper.getById('trojkaLogoPart3').remove() });
				paper.getById('trojkaLogoPart4').animate({ fill: "#FFFFFF", stroke: "#FFFFFF" }, 200, function () { paper.getById('trojkaLogoPart4').remove() });
				paper.getById('trojkaLogoPart5').animate({ fill: "#FFFFFF", stroke: "#FFFFFF" }, 200, function () { paper.getById('trojkaLogoPart5').remove() });
				paper.getById('trojkaLogoPart6').animate({ fill: "#FFFFFF", stroke: "#FFFFFF" }, 200, function () { paper.getById('trojkaLogoPart6').remove() });
				paper.getById('trojkaOuterCircle').animate({ "rx": 250, "ry": 250 }, 200, function () { initFinalCountDown(secondsCountDown-1); });
			}
		};

		//var finalCountDown = 6;
		var finalCountDownIconArray = new Array();
		var finalCountDownTextArray = new Array();
		var initFinalCountDown = function (finalCountDown) {
			var trojkaOuterCircle = paper.getById('trojkaOuterCircle');
			var matrix = trojkaOuterCircle.matrix;
			var scale = matrix.split().scalex;

			paper.getById('trojkaOuterCircle').remove();

			var x = 371.07144;
			var y = 512.4693;
			var x1 = x * matrix.a + y * matrix.b + matrix.e;
			var y1 = x * matrix.c + y * matrix.d + matrix.f;
			var c1 = paper.ellipse(x1, y1, 250 * scale, 250 * scale).attr({ fill: "none", "stroke": "#000000", "stroke-width": scale * strokeWidth, "stroke-linecap": "round", "stroke-linejoin": "round" });
			finalCountDownIconArray.push(c1);

			var tHeight = (250 * scale) + "px";
			var t1 = paper.text(x1, y1, finalCountDown).attr({ "font-size": tHeight, "font-family": "Arial, Helvetica, sans-serif", "text-anchor": "middle" }).attr({ fill: '#FFFFFF' });
			finalCountDownTextArray.push(t1);

			for (i = 1; i < finalCountDown; i++) {
				finalCountDownIconArray.push(c1.clone());
				finalCountDownTextArray.push(t1.clone().attr({ text: finalCountDown-i }));
			}
			var unitOffset = documentWidth / (finalCountDown + 1);
			for (i = 0; i < finalCountDown; i++) {
				finalCountDownIconArray[i].animate({ "cx": (i + 0.5) * unitOffset + logoSize / 2 }, 200);
				finalCountDownTextArray[i].animate({ "x": (i + 0.5) * unitOffset + logoSize / 2, fill: '#000000' }, 200);
			}
			
			secondsCountDown--;

			finalCountDownTimerId = window.setInterval(finalCountDownTransition, 1000);
		}

		var finalCountDownTimerId;
		var finalCountDownTransition = function () {
			if (finalCountDownIconArray.length == 0)
			{
				window.clearInterval(finalCountDownTimerId);
				return;
			}

			var clast = finalCountDownIconArray.shift();
			var tlast = finalCountDownTextArray.shift();
			clast.remove();
			tlast.remove();
			var unitOffset = documentWidth / (finalCountDownIconArray.length);
			for (i = 0; i < finalCountDownIconArray.length; i++) {
				finalCountDownIconArray[i].animate({ "cx": (i + 0.5) * unitOffset + logoSize / 2 }, 200);
				finalCountDownTextArray[i].animate({ "x": (i + 0.5) * unitOffset + logoSize / 2, fill: '#000000' }, 200);
			}

		}


		var fadeInOutAndStartCountDownAnimation = Raphael.animation({
			"fill": "#000000",
		}, fadeDuration, function () {
			this.animate(fadeOutAndStartCountDownAnimation.delay(fixDuration));
		});

		var step = 0;
		t11.animate(fadeInOutAnimation.delay(step * cycleDuration)); step++;
		t21.animate(fadeInOutAnimation.delay(step * cycleDuration)); step++;
		t12.animate(fadeInOutAnimation.delay(step * cycleDuration)); step++;
		t22.animate(fadeInOutAnimation.delay(step * cycleDuration)); step++;
		//t23.animate(fadeInOutAnimation.delay(step * cycleDuration)); step++;
		t13.animate(fadeInOutAnimation.delay(step * cycleDuration)); step++;
		t24.animate(fadeInOutAnimation.delay(step * cycleDuration)); step++;
		t14.animate(fadeInOutAndStartCountDownAnimation.delay(step * cycleDuration)); step++;


    </script>
</body>
</html>
